
-------------------------------------------------------------------------------------------------
---- README for THOR-LC-CCE-1.0
-------------------------------------------------------------------------------------------------
Changes to this file:

  08-05-2011 |   file created                         | Sebastian Schunert
-----------------------------------------------------------------------------
  09-21-2011 |   LC added                             | Sebastian Schunert
-----------------------------------------------------------------------------
  03-23-2012 |   Input variables global               | Sebastian Schunert
             |   Removed CLp1                         |
-----------------------------------------------------------------------------
  03-27-2012 |   1. Changed handling of reflect. BC   | Sebastian Schunert
             |      tested using all refl. 6grp       |
             |      See descr. reflective BC          |
             |   2. Fixed bugs in cell Jacobian subr. |
             |   3. Changed input format for inflow   |
             |      and mesh file.                    |
             |   4. JFNK still to be enabled, Queue   | 
             |      routine still to be improved      |
-----------------------------------------------------------------------------
 
This needs to be updated before next commit!!!                
                  
-------------------------------------------------------------------------------------------------

Compilation
 
  > ./gcompile CCE  32/64   => installs arbitrary order version (CCE); 32 or 64 bit
  > ./gcompile CLp1 32/64   => installs versions with Lambda fixed to -1 (CLp1); 32 or 64 bit  
  > ./gcompile LC   32/64   => installs versions with Lambda fixed to -1 using Mike's method; 32 or 64 bit  

CHANGES of THOR-1.0 with respect to THOR-0.0 (end of Mike's PhD work, summer 2010)

1. This version of THOR contains two different transport kernel implementations:
           
   a. CCE: This kernel computes the characteristic integrals on the fly. It has not
           been changed from Mike's original version. This version is slow so it is 
           right now only of development interest.
   
   b. CLp1: This transport kernel features hard-coded characteristic integrals to improve
            the performance. Only Lambda=-1 is allowed. 
   c. LC:   This transport kernel features hard-coded characteristic integrals to improve
            the performance. Only Lambda=-1 is allowed. It is different than CLp1 in the way
            the characteristic integrals are handled. This version is significantly more efficient.   

2. Changes to the stadard input: Several new input variables were introduced and the input was
   restructured. The input looks like that now
  
               Title
               problem eigs Lambda bsrc vtk  
               rest guess                    
               ng scord xsord                
               qtype qord                    
               epsk epsi epso maxi maxo      
               krsize maxk iPI method         ! if problem = 0 or eigs=0, leave blank      
if(problem=0)  src_file_name                  
if(bsrc   =1)  bsrc_file_name
if(qtype  =3)  quad_file_name                 ! not operable so far
               xs_file
               mesh_file
               flux_file
if(rest   =1)  restart_file
if(guess  =1)  initial_guess_file
if(vtk    =1)  vtk_output_file

   Explanations: Title    : problem title
                 problem  : 0 - fixed source, 1 - eigenvalue
                 eigs     : 0 - PI solution method, 1 - JFNK solution method
                 Lambda   : spatial expansion order
                 bsrc     : boundary source flag( if 1 then you must provide bsrc file)
                 vtk      : vtk formatted flux output (if 1 then you must provide file name)
                 rest     : restart flag ( if 1 a restart file is created and updated every outer
                            iteration/Newton iteration, if 1 you must provide file name, works only
                            for eigenvalue problem so far)
                 guess    : initial guess flag, if 1 an initial guess file consistent with the restart
                            output is read, if 1 you must provide file name, works only
                            for eigenvalue problem so far, checks for existence of inguess file and skips
                            reading if it does not exist
                 ng       : # energy groups
                 scord    : scattering expansion order in computation (only 0 so far)
                 xsord    : expansion order of scattering in XS file  (only 0 so far)
                 qtype    : quadrature type, 1 - Level symmetric (even order between 2 and 16)
                                             2 - SLC (2,3,5); more to come soon
                                             3 - from file; not operable so far
                 epsk     : stopping criterion for eigenvalue
                 epsi     : inf-norm stopping criterion for flux within an inner iteration
                 epso     : inf-norm stopping criterion for group fluxes within outer iteration   
                 maxi     : maximum number of inner iterations
                 maxo     : maximum number of outer iterations
                 Leave the next line blank if JFNK is not selected
                 krsize   : maximum subspace size before restart
                 maxk     : maximum # of krylov iterations per newton iteration
                 iPI      : # of initial power iterations before JFNK iterations
                 method   : JFNK solution method. 1 - F(u) corresponds to one outer iteration w/o upscattering
                                                  2 - F(u) flat iteration scheme
                                                  3 - F(u) flat iteration scheme with updated downscattering
                 filenames : self explanatory, do not enter anything (no blank line e.g.) if the condition in front
                             of the filename is false

   So far no changes have been made to the bsrc read routines but changes will be made in future version breaking 
   compatibility.   

3. The JFNK module developed by Sebastian Schunert at INL in summer 2010 was added. 

4. Upscattering was added but is TO BE VERIFIED.

5. The flux and source data structures have been changed. Angular sources were removed whereever possible and 
   a directed source and angular face fluxes are now allocated in the sweep routine as opposed to defining them in the
   outer iteration routine. This saves tremendous amounts of memory. However, if fixed influx BC (bsrc) are desired then a
   BSRC structure is allocate by MESH CELL not by BOUNDARY CELL. This will be changed in future versions. 

6. Convergence tests for PI are performed on the group flux as well as the fission source distribution. Also a separate 
   test on the eigenvalue is performed. 

7. THOR was prepared for allowing different quadrature sets (qtype). If qtype=2 the Square-Legendre-Chebyshev quadrature
   is selected. For now only orders 2,3 and 5 are implemented. If qtype=3 the quadrature is read from file but this option
   has not been implemented yet.    

   ---------------------------------------------------  03/23/2012  ------------------------------------------------------------

   1. Many input variables are now global. Stored in 'global_variable.f90'

   ---------------------------------------------------  03/23/2012  ------------------------------------------------------------

VERIFICATION of THOR-1.0

Preliminary verification (see verification THOR-1.0-CLp1 folder): 

Godiva: Godiva was solved using PI S4 and S8 quadrature, JFNK-1,2,3 using S8 quadrature. Eigenpairs agree to within
        stopping criteria with Mike's old results. Restart and initial guess options were also verified. TBV at this
        point is the SLC quadrature. 

S2, simple cube, pure absorption: Error decreases like  first order => expected due to smoothness of problem. 

